/*******************************************************************************************************************************//**
 *
 * @file		DR_I2C.c
 * @brief		Descripcion del modulo
 * @date		10 dic. 2020
 * @author		R2002 - Melamed Damian
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include <DR/DR_I2C.h>
#include <DR/DR_PLL.h>
/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/
#define POWER_I2C1_ON (PCONP |= (1 << PI2C1))
#define POWER_I2C1_OFF (PCONP &= ~(1 << PI2C1))

#define 	I2C1	((I2C_t *)(0x4005C000UL))
/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/
typedef struct _I2C_CONSET_t{
	uint32_t RESERVED_0:2;
	uint32_t AssertAck_flag:1;
	uint32_t SI_flag:1;
	uint32_t STOP_falg:1;
	uint32_t START_flag:1;
	uint32_t I2C_En:1;
	uint32_t RESERVED_1:25;
} I2C_CONSET_t;

typedef struct _I2C_CONCLR_t{
	uint32_t RESERVED_0: 2;
	uint32_t AssertAck_clr:1;
	uint32_t I2C_Int_clr:1;
	uint32_t RESERVED_1:1;
	uint32_t START_flag_clr:1;
	uint32_t I2C_Disable:1;
	uint32_t RESERVED_2:25;
}I2C_CONCLR_t;

typedef struct _I2C_MMCTRL_t{
	uint32_t MonitorMode_en:1;
	uint32_t SCL_out_en:1;
	uint32_t Match_Int_en:1;
	uint32_t RESERVED_0:29;
}I2C_MMCTRL_t;

typedef struct _I2C_t{
	I2C_CONSET_t CONSET;
	uint32_t STAT;
	uint32_t DAT;
	uint32_t ADR0;
	uint32_t SCLH;
	uint32_t SCLL;
	I2C_CONCLR_t CONCLR;
	uint32_t MMCTRL;
	uint32_t ADR1;
	uint32_t ADR2;
	uint32_t ADR3;
	uint32_t DATA_BUFF;
	uint32_t MASK[4];
}I2C_t;
/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/
/**
	\fn  Nombre de la Funcion
	\brief Descripcion
 	\author R2002 - Melamed Damian
 	\date 10 dic. 2020
 	\param [in] parametros de entrada
 	\param [out] parametros de salida
	\return tipo y descripcion de retorno
*/
void InicializarI2C_DR(void){
	POWER_I2C1_ON;
	PCLKSEL1 &= ~(3 << PCLK_I2C1);

	//hacer en PR PINSEL. PINMODE modo 0x02. PINMODE_OD en 0x01

	I2C1->CONCLR.AssertAck_clr = 1;
	I2C1->CONCLR.I2C_Int_clr = 1;
	I2C1->CONCLR.START_flag_clr = 1;
	I2C1->CONCLR.I2C_Disable = 1;

	//Fi2c = (F_CLK/PCLK)/(SCLH+SCLL) = 100kHz
	I2C1->SCLH=125;
	I2C1->SCLL=125;

	ISER0 |= (1 << ISER_I2C1);
	I2C1->CONSET.I2C_En = 1;
}
