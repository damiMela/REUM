/*******************************************************************************************************************************//**
 *
 * @file		PR_I2C.c
 * @brief		Descripcion del modulo
 * @date		11 dic. 2020
 * @author		R2002 - Melamed Damian
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include <PR/PR_I2C.h>
#include <DR/DR_I2C.h>
#include <DR/DR_Pinsel.h>
#include <DR/DR_GPIO.h>
/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/
/**
	\fn  Nombre de la Funcion
	\brief Descripcion
 	\author R2002 - Melamed Damian
 	\date 11 dic. 2020
 	\param [in] parametros de entrada
 	\param [out] parametros de salida
	\return tipo y descripcion de retorno
*/
void InicializarI2C(void){
	setPinsel(SDA1,FUNCION_3); //SDA
	setPinsel(SCL1,FUNCION_3);  //SCL

	setPinmode(SDA1, MODE_NONE);
	setPinmode(SCL1, MODE_NONE); //Seteo el Open-drain mode

	setPinmode_OD(SDA1, MODE_OD_NHIGH);
	setPinmode_OD(SCL1, MODE_OD_NHIGH); //Seteo el Open-drain mode

	InicializarI2C_DR();
}

void I2C_beginTransmition(uint8_t address){
	I2C1_MasterBuff[0] = address * 2; // SLA+W --> address & 0
	I2C1_WriteLen = 0;
	I2C1_ReadLen = 0;
}

void I2C_put(uint8_t msg){
	I2C1_WriteLen++;
	I2C1_MasterBuff[I2C1_WriteLen] = msg;
}

void I2C_get(uint8_t len){
	I2C1_ReadLen = len;
}

uint8_t I2C_endTransmition(){
	if(I2C1_Engine() == I2C_OK) return 1;
	return 0;
}

void I2C_getData(uint8_t len, uint8_t *data){
	for(uint8_t j = 0; j < len; j++){
		data[j] = I2C1_SlaveBuff[j];
		I2C1_SlaveBuff[j] = 0;
	}
}
