/*******************************************************************************************************************************//**
 *
 * @file		PR_I2C.c
 * @brief		Descripcion del modulo
 * @date		11 dic. 2020
 * @author		R2002 - Melamed Damian
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include <PR/PR_I2C.h>
#include <DR/DR_I2C.h>
#include <DR/DR_Pinsel.h>
#include <DR/DR_GPIO.h>
/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/
/**
	\fn  Nombre de la Funcion
	\brief Descripcion
 	\author R2002 - Melamed Damian
 	\date 11 dic. 2020
 	\param [in] parametros de entrada
 	\param [out] parametros de salida
	\return tipo y descripcion de retorno
*/
void InicializarI2C(void){
	setPinsel(SDA_PIN, FUNCION_3);
	setPinsel(SCL_PIN, FUNCION_3);
	setPinmode(SDA_PIN, MODE_NONE);
	setPinmode(SCL_PIN, MODE_NONE);
	setPinmode_OD(SDA_PIN, MODE_OD_NLOW);
	setPinmode_OD(SCL_PIN, MODE_OD_NLOW);

	InicializarI2C_DR();
}


uint8_t I2C_write(uint8_t address, uint8_t lenght, uint8_t *msg){
	uint8_t ret = 0;
	if(msg){
		I2C1_writeLenght = lenght+2;
		I2C1_readLenght = 0;

		I2C1_Master_buff[0] = address; // SLA+W
		for(uint8_t i = 0; i < lenght; i++){
			I2C1_Master_buff[i+1] = msg[i];
		}
		uint8_t result;
		result = I2C_engine();
		if(result == I2C_OK)
			ret = 1;
	}
	return ret;
}
